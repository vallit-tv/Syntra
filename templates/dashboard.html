{% extends "base.html" %}

{% block title %}Dashboard â€“ Syntra{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="mb-8">
            <h1 class="section-title" style="font-size: 2rem; text-align: left; margin-bottom: 1rem;">Dashboard</h1>
            <p style="color: var(--color-text-light);">Welcome, <strong>{{ user.name }}</strong>!</p>
        </div>
        
        <div class="card mb-8">
            <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: var(--spacing-lg);">API Keys</h2>
            <div id="apiKeysList">
                {% if api_keys %}
                    {% for key in api_keys %}
                    <div class="card" style="margin-bottom: var(--spacing-md); padding: var(--spacing-md);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="font-weight: 600; margin-bottom: var(--spacing-xs);">{{ key.name }}</h3>
                                <p style="font-size: 0.875rem; color: var(--color-text-light);">Type: {{ key.type }}</p>
                            </div>
                            <button onclick="deleteKey('{{ key.id }}')" class="btn btn-danger" style="padding: var(--spacing-xs) var(--spacing-md);">Delete</button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="color: var(--color-text-light);">No API keys yet.</p>
                {% endif %}
            </div>
        </div>
        
        <div class="card">
            <h2 style="font-size: 1.5rem; font-weight: 600; margin-bottom: var(--spacing-lg);">Add New API Key</h2>
            <form id="addKeyForm">
                <div class="form-group">
                    <label for="keyName" class="form-label">Name</label>
                    <input type="text" id="keyName" name="name" required class="form-input" placeholder="API key name">
                </div>
                <div class="form-group">
                    <label for="keyType" class="form-label">Type</label>
                    <input type="text" id="keyType" name="type" required class="form-input" placeholder="e.g., OpenAI, Notion">
                </div>
                <div class="form-group">
                    <label for="keyValue" class="form-label">Key Value</label>
                    <input type="text" id="keyValue" name="key" required class="form-input" placeholder="Enter API key">
                </div>
                <button type="submit" class="btn btn-primary">Add Key</button>
            </form>
        </div>
    </div>
</section>

{% block scripts %}
<script>
handleFormSubmit('addKeyForm', '/api/keys', () => {
    location.reload();
});

function deleteKey(keyId) {
    if (confirm('Are you sure you want to delete this key?')) {
        fetch('/api/keys/' + keyId, { method: 'DELETE' })
            .then(() => location.reload())
            .catch(err => alert('Error: ' + err));
    }
}
</script>
{% endblock %}
{% endblock %}