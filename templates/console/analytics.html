{% extends "layout_console.html" %}

{% block page_title %}Admin Console{% endblock %}

{% block content %}
<div style="max-width: 1000px;">

    <div class="subtitle">
        SYSTEM OVERVIEW · <span style="color:var(--console-success)">● ONLINE</span>
    </div>

    <!-- STATS GRID -->
    <div class="status-grid" style="margin-bottom: var(--space-xl);">
        <div class="status-item">
            <span class="status-label">Total Executions</span>
            <div class="status-value">
                {{ execution_stats.total }}
            </div>
        </div>

        <div class="status-item">
            <span class="status-label">Success Rate</span>
            <div class="status-value">
                <span
                    style="color: {% if execution_stats.success_rate > 90 %}var(--console-success){% else %}var(--console-error){% endif %}">
                    {{ "%.1f"|format(execution_stats.success_rate) }}%
                </span>
            </div>
        </div>

        <div class="status-item">
            <span class="status-label">Avg Duration</span>
            <div class="status-value">
                {% if execution_stats.avg_duration %}
                {{ "%.2f"|format(execution_stats.avg_duration / 1000) }}s
                {% else %}
                -
                {% endif %}
            </div>
        </div>

        <div class="status-item">
            <span class="status-label">Failed</span>
            <div class="status-value">
                <span
                    style="color: {% if execution_stats.failed > 0 %}var(--console-error){% else %}var(--console-text-secondary){% endif %}">
                    {{ execution_stats.failed }}
                </span>
            </div>
        </div>
    </div>

    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: var(--space-xl);">

        <!-- TOP WORKFLOWS -->
        <div>
            <h2 style="font-size: 14px; font-weight: 500; margin-bottom: var(--space-md);">Top Workflows</h2>
            <div class="console-list">
                {% for wf in top_workflows %}
                <div class="list-item" style="cursor: default;">
                    <div class="list-col">
                        <i data-lucide="workflow" width="16" height="16"></i>
                        <span>{{ wf.name }}</span>
                    </div>
                    <div class="list-col">
                        <span class="badge">{{ wf.runs }} runs</span>
                    </div>
                </div>
                {% else %}
                <div class="panel" style="text-align: center; color: var(--console-text-tertiary);">
                    No workflow activity yet.
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- RECENT FAILURES -->
        <div>
            <h2 style="font-size: 14px; font-weight: 500; margin-bottom: var(--space-md);">Recent Failures</h2>
            {% if recent_failures %}
            <div class="console-list">
                {% for failure in recent_failures %}
                <div class="list-item" style="border-left: 2px solid var(--console-error);">
                    <div class="list-col">
                        <i data-lucide="alert-circle" width="16" height="16" style="color: var(--console-error);"></i>
                        <div>
                            <div style="font-weight: 500;">
                                {{ failure.workflow_activations.workflows.name if failure.workflow_activations and
                                failure.workflow_activations.workflows else 'Unknown Workflow' }}
                            </div>
                            <div style="font-size: 11px; color: var(--console-text-tertiary);">
                                {{ failure.started_at|datetime }}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="panel"
                style="text-align: center; color: var(--console-text-tertiary); padding: var(--space-lg);">
                <i data-lucide="check-circle" width="24" height="24"
                    style="color: var(--console-success); margin-bottom: var(--space-sm);"></i>
                <div>No recent failures</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- RECENT ACTIVITY TABLE -->
    <div style="margin-top: var(--space-xl);">
        <h2 style="font-size: 14px; font-weight: 500; margin-bottom: var(--space-md);">Recent Activity</h2>

        <div class="panel" style="padding: 0; overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead style="border-bottom: 1px solid var(--console-border); background: var(--console-bg-secondary);">
                    <tr>
                        <th
                            style="text-align: left; padding: 12px; font-weight: 500; color: var(--console-text-secondary);">
                            Workflow</th>
                        <th
                            style="text-align: left; padding: 12px; font-weight: 500; color: var(--console-text-secondary);">
                            Status</th>
                        <th
                            style="text-align: right; padding: 12px; font-weight: 500; color: var(--console-text-secondary);">
                            Duration</th>
                        <th
                            style="text-align: right; padding: 12px; font-weight: 500; color: var(--console-text-secondary);">
                            Time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for exec in executions[:20] %}
                    <tr style="border-bottom: 1px solid var(--console-border);">
                        <td style="padding: 12px; color: var(--console-text-primary);">
                            {{ exec.workflow_activations.workflows.name if exec.workflow_activations and
                            exec.workflow_activations.workflows else 'Unknown Workflow' }}
                        </td>
                        <td style="padding: 12px;">
                            {% if exec.status == 'success' %}
                            <span class="badge"
                                style="background: rgba(34, 197, 94, 0.1); color: #22c55e; border: none;">Success</span>
                            {% elif exec.status == 'error' %}
                            <span class="badge"
                                style="background: rgba(239, 68, 68, 0.1); color: #ef4444; border: none;">Error</span>
                            {% else %}
                            <span class="badge">{{ exec.status }}</span>
                            {% endif %}
                        </td>
                        <td
                            style="padding: 12px; text-align: right; color: var(--console-text-secondary); font-family: monospace;">
                            {% if exec.duration_ms %}{{ "%.2f"|format(exec.duration_ms/1000) }}s{% else %}-{% endif %}
                        </td>
                        <td
                            style="padding: 12px; text-align: right; color: var(--console-text-tertiary); font-size: 12px;">
                            {{ exec.started_at|datetime }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}